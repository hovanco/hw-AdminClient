{"ast":null,"code":"import axios from 'axios';\nimport queryString from 'query-string';\nimport constants from '../constants';\nimport authApi from './auth-api';\nimport { getToken, checkToken, removeToken, getTokenLocal, setToken } from './token';\nlet isRefreshed = false;\nconst axiosClient = axios.create({\n  baseURL: constants.URL_API,\n  headers: {\n    'content-type': 'application/json'\n  },\n  paramsSerializer: params => queryString.stringify(params)\n});\naxiosClient.interceptors.request.use(async config => {\n  const token = getToken();\n\n  if (token) {\n    config.headers['Authorization'] = 'Bearer ' + token;\n  } // Handle token here ...\n\n\n  return config;\n});\naxiosClient.interceptors.response.use(response => {\n  if (response && response.data) {\n    return response.data;\n  }\n\n  return response;\n}, async error => {\n  const originalRequest = error.config;\n\n  if (error.response.status === 401 && !isRefreshed) {\n    isRefreshed = true;\n    const refreshToken = getToken('refreshToken');\n\n    if (refreshToken) {\n      const isValidRefreshToken = checkToken(refreshToken);\n\n      if (!isValidRefreshToken) {\n        removeToken();\n        return Promise.reject(error);\n      }\n\n      try {\n        const response = await authApi.refreshAccessToken(refreshToken);\n        const {\n          accessToken\n        } = response;\n        const tokenLocal = getTokenLocal();\n        setToken({\n          token: { ...tokenLocal,\n            accessToken\n          },\n          remember: true\n        });\n        originalRequest._retry = true;\n        axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n        return axiosClient(originalRequest);\n      } catch (err) {\n        if (err.response.status === 401) {\n          if (refreshToken) {\n            await authApi.logout(refreshToken);\n          }\n\n          removeToken();\n        }\n\n        return Promise.reject(err);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n\n  return Promise.reject(error);\n});\nexport default axiosClient;","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/AdminClient/src/api/axios-client.ts"],"names":["axios","queryString","constants","authApi","getToken","checkToken","removeToken","getTokenLocal","setToken","isRefreshed","axiosClient","create","baseURL","URL_API","headers","paramsSerializer","params","stringify","interceptors","request","use","config","token","response","data","error","originalRequest","status","refreshToken","isValidRefreshToken","Promise","reject","refreshAccessToken","accessToken","tokenLocal","remember","_retry","defaults","common","err","logout"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport queryString from 'query-string';\nimport constants from '../constants';\nimport authApi from './auth-api';\nimport { getToken, checkToken, removeToken, getTokenLocal, setToken, IToken } from './token';\n\nlet isRefreshed = false;\n\nconst axiosClient = axios.create({\n    baseURL: constants.URL_API,\n    headers: {\n        'content-type': 'application/json',\n    },\n    paramsSerializer: (params) => queryString.stringify(params),\n});\n\naxiosClient.interceptors.request.use(async (config) => {\n    const token = getToken();\n\n    if (token) {\n        config.headers['Authorization'] = 'Bearer ' + token;\n    }\n    // Handle token here ...\n    return config;\n});\n\naxiosClient.interceptors.response.use(\n    (response) => {\n        if (response && response.data) {\n            return response.data;\n        }\n\n        return response;\n    },\n    async (error) => {\n        const originalRequest = error.config;\n\n        if (error.response.status === 401 && !isRefreshed) {\n            isRefreshed = true;\n\n            const refreshToken = getToken('refreshToken');\n\n            if (refreshToken) {\n                const isValidRefreshToken = checkToken(refreshToken);\n\n                if (!isValidRefreshToken) {\n                    removeToken();\n                    return Promise.reject(error);\n                }\n\n                try {\n                    const response = await authApi.refreshAccessToken(refreshToken);\n                    const { accessToken } = response;\n\n                    const tokenLocal = getTokenLocal();\n\n                    setToken({\n                        token: {\n                            ...(tokenLocal as IToken),\n                            accessToken,\n                        },\n                        remember: true,\n                    });\n\n                    originalRequest._retry = true;\n\n                    axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n\n                    return axiosClient(originalRequest);\n                } catch (err) {\n                    if (err.response.status === 401) {\n                        if (refreshToken) {\n                            await authApi.logout(refreshToken);\n                        }\n\n                        removeToken();\n                    }\n\n                    return Promise.reject(err);\n                }\n            }\n\n            return Promise.reject(error);\n        }\n\n        return Promise.reject(error);\n    },\n);\n\nexport default axiosClient;\n"]},"metadata":{},"sourceType":"module"}